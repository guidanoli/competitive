#!/usr/bin/env bash

# Program variables
export programpath="${BASH_SOURCE[0]}"
export programname=$(basename "$programpath")
export programroot=$(dirname $(dirname "$programpath"))

# If missing command
if [[ $# -eq 0 ]]; then

	# print usage information
	echo "Competitive Programming Toolkit"
	echo ""
	echo "Usage: $programname <command> [[<language>] <command-arguments>]"
	echo ""
	echo "If <language> is ommitted, the last mentioned language is used."
	echo "These are all the available commands"
	echo ""
	echo "command    description                        arguments"
	echo "-------    -----------                        ---------"
	echo "clear      clear temporary files"
	echo "clip       copy program to clipboard"
	echo "debug      debug program                      compiler options (1)"
	echo "edit       edit program with vim"
	echo "init       set current language"
	echo "list       list all projects"
	echo "load       load project                       project name"
	echo "path       print program path                 class name (2)"
	echo "run        run program                        compiler options (1)"
	echo "save       save project                       project name"
	echo "xpath      print compiled program path (3)"
	echo ""
	echo "(1) for c, c++, c# and haskell"
	echo "(2) for java"
	echo "(3) for c, c++, c#, go, haskell and kotlin"

else

	# Save command
	command="$1"
	shift

	# If not seeking help but base command exists
	if [[ -f "$programroot/libexec/base/$command" ]]; then

		# then push base directory
		pushd "$programroot" > /dev/null

		# run the command and pass any additional options
		libexec/call "$command" "$@" 

		# and pop directory
		popd > /dev/null
	else
		# else exit
		source "$programroot/libexec/err/7"
	fi

fi
