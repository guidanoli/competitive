#!/usr/bin/env bash

# Program variables
export programpath=$(readlink -f "${BASH_SOURCE[0]}")
export programname=$(basename "$programpath")
export programroot=$(dirname $(dirname "$programpath"))

# If missing command
if [[ $# -eq 0 ]]; then

	# print usage information
	echo "Competitive Programming Toolkit"
	echo ""
	echo "Usage: $programname <command> [<language> [<arguments>]]"
	echo ""
	echo "If <language> is ommitted, the last mentioned language is used."
	echo "These are all the available commands"
	echo ""
	echo "command    description                        arguments"
	echo "-------    -----------                        ---------"
	echo "clear      clear temporary files"
	echo "clip       copy program to clipboard"
	echo "debug      debug program"
	echo "edit       edit program with vim"
	echo "init       set current language"
	echo "list       list all projects"
	echo "load       load project                       project name"
	echo "path       print program path"
	echo "run        run program"
	echo "save       save project                       project name"
	echo ""
	echo "Language-specific environment variables"
	echo ""
	echo "language    environment variable    description"
	echo "--------    --------------------    -----------"
	echo "c           CFLAGS                  gcc flags"
	echo "c++         CPPFLAGS                g++ flags"
	echo "c#          CSFLAGS                 mcs flags"
	echo "haskell     HSFLAGS                 ghc flags"
	echo "java        JAVACLASS               class name"

else

	# Save command
	command="$1"
	shift

	# If base command exists
	if [[ -f "$programroot/libexec/base/$command" ]]; then

		# then push base directory
		pushd "$programroot" > /dev/null

		# run the command and pass any additional options
		libexec/call "$command" "$@" 

		# and pop directory
		popd > /dev/null
	else
		# else exit
		source "$programroot/libexec/err/7"
	fi

fi
