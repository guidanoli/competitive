#!/usr/bin/env bash

# Exit on error
set -e

# Program variables
export programpath=$(readlink -f "${BASH_SOURCE[0]}")
export programname=$(basename "$programpath")
export programroot=$(dirname "$(dirname "$programpath")")

# Get command
if [[ $# -ge 1 ]]; then
	command=$1
	shift
else
	command=help
fi

# Get base directory
basedir=$programroot/libexec/base

# If base command exists and is in the base directory
if $programroot/libexec/is-child "$basedir" "$command" -type f ; then

	# then push root directory
	pushd "$programroot" > /dev/null

	# source the base command
	source "$basedir/$command"

	# and pop directory
	popd > /dev/null

else
	# else exit
	source "$programroot/libexec/err/unknown-command"
fi
